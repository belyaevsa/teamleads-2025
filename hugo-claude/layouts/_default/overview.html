{{ define "main" }}
{{ $data := .Site.Data.metrics }}

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<!-- Hero Section with Background Image -->
<section class="relative min-h-[60vh] flex items-center justify-center overflow-hidden">
  <!-- Hero Background Image -->
  <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
    <img src="/images/overview/hero.png" alt="" class="w-full h-full object-cover opacity-30"
      style="mask-image: linear-gradient(to bottom, transparent 0%, black 20%, black 80%, transparent 100%); -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 20%, black 80%, transparent 100%);">
  </div>

  <!-- Content -->
  <div class="relative z-10 text-center px-4 max-w-5xl mx-auto pt-16">
    <div class="flex items-center justify-center gap-3 mb-6">
      <span class="text-6xl md:text-7xl">üìä</span>
    </div>
    <h1 class="text-4xl md:text-6xl lg:text-7xl font-heading font-bold mb-6 tracking-tight">
      <span class="text-gradient-ai">–¶–∏—Ñ—Ä—ã –Ω–µ –≤—Ä—É—Ç</span>
    </h1>
    <p class="text-lg md:text-xl text-slate-400 max-w-3xl mx-auto leading-relaxed">
      –ö–∞–∫ –º—ã —Ä–æ—Å–ª–∏ –∏ –æ —á—ë–º —Å–ø–æ—Ä–∏–ª–∏
    </p>
  </div>
</section>

<!-- Quick Stats -->
<section class="relative py-16 px-4">
  <div class="container mx-auto max-w-7xl">

    <!-- Quick Stats Grid -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-16">
      <div class="bento-card p-6 text-center">
        <div class="font-data text-4xl font-bold text-telegram-blue mb-2">{{ $data.growth_stats.avg_daily_messages }}</div>
        <div class="text-slate-400 text-sm">–°–æ–æ–±—â–µ–Ω–∏–π –≤ –¥–µ–Ω—å</div>
      </div>
      <div class="bento-card p-6 text-center">
        <div class="font-data text-4xl font-bold text-ai-purple-start mb-2">{{ $data.active_days }}</div>
        <div class="text-slate-400 text-sm">–ê–∫—Ç–∏–≤–Ω—ã—Ö –¥–Ω–µ–π</div>
      </div>
      <div class="bento-card p-6 text-center">
        <div class="font-data text-4xl font-bold text-management-orange-start mb-2">{{ $data.growth_stats.max_daily_messages }}</div>
        <div class="text-slate-400 text-sm">–ú–∞–∫—Å–∏–º—É–º –∑–∞ –¥–µ–Ω—å</div>
      </div>
      <div class="bento-card p-6 text-center">
        <div class="font-data text-4xl font-bold text-green-400 mb-2">+{{ $data.growth_stats.fastest_growth_value }}%</div>
        <div class="text-slate-400 text-sm">–†–æ—Å—Ç –≤ {{ $data.growth_stats.fastest_growth_month }}</div>
      </div>
    </div>
  </div>
</section>

<!-- Hourly Activity Chart -->
<section class="relative py-16 px-4 bg-gradient-to-b from-transparent to-deep-space/50">
  <div class="container mx-auto max-w-7xl">
    <h2 class="text-3xl md:text-4xl font-heading font-bold text-center mb-4 text-starlight">
      –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ <span class="text-gradient-ai">–ß–∞—Å–∞–º</span>
    </h2>
    <p class="text-center text-slate-400 mb-12 max-w-2xl mx-auto">
      –ö–æ–≥–¥–∞ —Ç–∏–º–ª–∏–¥—ã –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç–∏–≤–Ω—ã –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è
    </p>

    <div class="relative">
      <canvas id="hourly-chart" style="max-height: 400px;"></canvas>
    </div>

    <!-- Insights -->
    <div class="grid md:grid-cols-3 gap-6 mt-12">
      <div class="bento-card p-6">
        <div class="text-3xl mb-3">üåÖ</div>
        <h3 class="font-heading font-bold text-lg text-starlight mb-2">–£—Ç—Ä–æ (6:00-12:00)</h3>
        <div class="font-data text-2xl text-telegram-blue mb-2">{{ $data.hourly_activity.morning_peak | lang.FormatNumber 0 }}</div>
        <p class="text-slate-400 text-sm">–£—Ç—Ä–µ–Ω–Ω–∏–π –ø–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</p>
      </div>
      <div class="bento-card p-6">
        <div class="text-3xl mb-3">‚òÄÔ∏è</div>
        <h3 class="font-heading font-bold text-lg text-starlight mb-2">–î–µ–Ω—å (12:00-18:00)</h3>
        <div class="font-data text-2xl text-ai-purple-start mb-2">{{ $data.hourly_activity.afternoon | lang.FormatNumber 0 }}</div>
        <p class="text-slate-400 text-sm">–ü–∏–∫ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è</p>
      </div>
      <div class="bento-card p-6">
        <div class="text-3xl mb-3">üåô</div>
        <h3 class="font-heading font-bold text-lg text-starlight mb-2">–í–µ—á–µ—Ä (18:00-00:00)</h3>
        <div class="font-data text-2xl text-management-orange-start mb-2">{{ $data.hourly_activity.evening | lang.FormatNumber 0 }}</div>
        <p class="text-slate-400 text-sm">–í–µ—á–µ—Ä–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</p>
      </div>
    </div>
  </div>
</section>

<!-- Monthly Comparison -->
<section class="relative py-16 px-4">
  <div class="container mx-auto max-w-7xl">
    <h2 class="text-3xl md:text-4xl font-heading font-bold text-center mb-4 text-starlight">
      –°—Ä–∞–≤–Ω–µ–Ω–∏–µ <span class="text-gradient-management">–ø–æ –ú–µ—Å—è—Ü–∞–º</span>
    </h2>
    <p class="text-center text-slate-400 mb-12 max-w-2xl mx-auto">
      –î–∏–Ω–∞–º–∏–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ —Ç–µ—á–µ–Ω–∏–µ –≥–æ–¥–∞
    </p>

    <div class="relative">
      <canvas id="monthly-comparison-chart" style="max-height: 450px;"></canvas>
    </div>

    <!-- Monthly Insights -->
    <div class="grid md:grid-cols-2 gap-6 mt-12">
      <div class="bento-card p-6 border-l-4 border-green-500">
        <h3 class="font-heading font-bold text-lg text-starlight mb-3">üìà –ü–µ—Ä–∏–æ–¥ —Ä–æ—Å—Ç–∞</h3>
        <p class="text-slate-300 mb-3">
          <strong class="text-green-400">–ê–ø—Ä–µ–ª—å-–ú–∞–π:</strong> +192% —Ä–æ—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏–π.
          –ú–∞–π —Å—Ç–∞–ª –ø–µ—Ä–µ–ª–æ–º–Ω—ã–º –º–µ—Å—è—Ü–µ–º —Å 3 600 —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏.
        </p>
        <p class="text-slate-400 text-sm">
          –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å 47 –Ω–æ–≤—ã—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
        </p>
      </div>
      <div class="bento-card p-6 border-l-4 border-red-500">
        <h3 class="font-heading font-bold text-lg text-starlight mb-3">üìâ –õ–µ—Ç–Ω–∏–π —Å–ø–∞–¥</h3>
        <p class="text-slate-300 mb-3">
          <strong class="text-red-400">–ò—é–ª—å-–ê–≤–≥—É—Å—Ç:</strong> –°–Ω–∏–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–∞ 76%.
          –ê–≤–≥—É—Å—Ç –ø–æ–∫–∞–∑–∞–ª –º–∏–Ω–∏–º—É–º ‚Äì 857 —Å–æ–æ–±—â–µ–Ω–∏–π.
        </p>
        <p class="text-slate-400 text-sm">
          –¢–∏–ø–∏—á–Ω—ã–π —Å–µ–∑–æ–Ω–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è IT-—Å–æ–æ–±—â–µ—Å—Ç–≤
        </p>
      </div>
    </div>
  </div>
</section>

<!-- Key Milestones Timeline -->
<section class="relative py-16 px-4 bg-gradient-to-b from-deep-space/50 to-transparent">
  <div class="container mx-auto max-w-7xl">
    <h2 class="text-3xl md:text-4xl font-heading font-bold text-center mb-4 text-starlight">
      –ö–ª—é—á–µ–≤—ã–µ <span class="text-gradient-ai">–í–µ—Ö–∏</span>
    </h2>
    <p class="text-center text-slate-400 mb-12 max-w-2xl mx-auto">
      –°–∞–º—ã–µ –≤–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã 2025 –≥–æ–¥–∞
    </p>

    <div class="space-y-8">
      {{ range $data.timeline_milestones }}
      <div class="bento-card p-6 hover:border-telegram-blue/50 transition-all">
        <div class="flex items-start gap-4">
          <div class="flex-shrink-0 w-16 h-16 rounded-full bg-gradient-to-br from-telegram-blue to-ai-purple-start flex items-center justify-center font-heading font-bold text-lg">
            {{ index (split .month "") 0 }}{{ index (split .month "") 1 }}
          </div>
          <div class="flex-1">
            <div class="flex items-center justify-between mb-2">
              <h3 class="font-heading font-bold text-xl text-starlight">{{ .title }}</h3>
              <div class="font-data text-2xl text-telegram-blue">{{ .messages | lang.FormatNumber 0 }}</div>
            </div>
            <p class="text-slate-400 mb-2">{{ .month }} 2025</p>
            <p class="text-slate-300">{{ .highlight }}</p>
          </div>
        </div>
      </div>
      {{ end }}
    </div>
  </div>
</section>

<!-- Hourly Activity Chart Script -->
<script>
(function() {
  const ctx = document.getElementById('hourly-chart');
  if (!ctx) return;

  const labels = {{ $data.hourly_activity.labels }};
  const messages = {{ $data.hourly_activity.messages }};

  if (!Array.isArray(labels) || !Array.isArray(messages)) {
    console.error('Invalid hourly activity data');
    return;
  }

  // Create gradient
  const gradient = ctx.getContext('2d').createLinearGradient(0, 0, 0, 400);
  gradient.addColorStop(0, 'rgba(168, 85, 247, 0.5)');
  gradient.addColorStop(1, 'rgba(168, 85, 247, 0.0)');

  const config = {
    type: 'line',
    data: {
      labels: labels.map(h => h + ':00'),
      datasets: [{
        label: '–°–æ–æ–±—â–µ–Ω–∏–π',
        data: messages,
        fill: true,
        backgroundColor: gradient,
        borderColor: '#A855F7',
        borderWidth: 3,
        tension: 0.4,
        pointRadius: 4,
        pointBackgroundColor: '#A855F7',
        pointBorderColor: 'rgba(255, 255, 255, 0.8)',
        pointBorderWidth: 2,
        pointHoverRadius: 6
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      plugins: {
        legend: { display: false },
        tooltip: {
          enabled: true,
          backgroundColor: 'rgba(15, 23, 42, 0.95)',
          titleColor: '#F8FAFC',
          bodyColor: '#94A3B8',
          borderColor: 'rgba(255, 255, 255, 0.1)',
          borderWidth: 1,
          padding: 12,
          displayColors: false,
          titleFont: { family: 'Inter', size: 14, weight: 'bold' },
          bodyFont: { family: 'JetBrains Mono', size: 12 },
          callbacks: {
            title: function(context) {
              return '–ß–∞—Å: ' + context[0].label;
            },
            label: function(context) {
              return context.parsed.y.toLocaleString('ru-RU') + ' —Å–æ–æ–±—â–µ–Ω–∏–π';
            }
          }
        }
      },
      scales: {
        x: {
          grid: { display: false },
          ticks: {
            color: '#64748B',
            font: { family: 'Inter', size: 11 },
            maxRotation: 45,
            minRotation: 45
          }
        },
        y: {
          beginAtZero: true,
          grid: {
            color: 'rgba(148, 163, 184, 0.1)',
            drawBorder: false
          },
          ticks: {
            color: '#64748B',
            font: { family: 'JetBrains Mono', size: 11 },
            callback: function(value) {
              return value.toLocaleString('ru-RU');
            }
          }
        }
      },
      animation: {
        duration: 2000,
        easing: 'easeInOutQuart'
      }
    }
  };

  new Chart(ctx, config);
})();
</script>

<!-- Monthly Comparison Chart Script -->
<script>
(function() {
  const ctx = document.getElementById('monthly-comparison-chart');
  if (!ctx) return;

  const labels = {{ $data.monthly_data.labels }};
  const messages = {{ $data.monthly_data.messages }};
  const contributors = {{ $data.monthly_data.contributors }};

  if (!Array.isArray(labels) || !Array.isArray(messages) || !Array.isArray(contributors)) {
    console.error('Invalid monthly comparison data');
    return;
  }

  const config = {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [
        {
          label: '–°–æ–æ–±—â–µ–Ω–∏—è',
          data: messages,
          backgroundColor: 'rgba(36, 129, 204, 0.7)',
          borderColor: '#2481CC',
          borderWidth: 2,
          borderRadius: 6,
          yAxisID: 'y'
        },
        {
          label: '–£—á–∞—Å—Ç–Ω–∏–∫–∏',
          data: contributors,
          type: 'line',
          borderColor: '#F97316',
          backgroundColor: 'rgba(249, 115, 22, 0.1)',
          borderWidth: 3,
          tension: 0.4,
          pointRadius: 5,
          pointBackgroundColor: '#F97316',
          pointBorderColor: '#fff',
          pointBorderWidth: 2,
          yAxisID: 'y1'
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      interaction: {
        mode: 'index',
        intersect: false
      },
      plugins: {
        legend: {
          display: true,
          position: 'top',
          labels: {
            color: '#94A3B8',
            font: { family: 'Inter', size: 13 },
            padding: 15,
            usePointStyle: true
          }
        },
        tooltip: {
          enabled: true,
          backgroundColor: 'rgba(15, 23, 42, 0.95)',
          titleColor: '#F8FAFC',
          bodyColor: '#94A3B8',
          borderColor: 'rgba(255, 255, 255, 0.1)',
          borderWidth: 1,
          padding: 12,
          titleFont: { family: 'Inter', size: 14, weight: 'bold' },
          bodyFont: { family: 'JetBrains Mono', size: 12 },
          callbacks: {
            label: function(context) {
              const label = context.dataset.label || '';
              const value = context.parsed.y;
              if (label === '–°–æ–æ–±—â–µ–Ω–∏—è') {
                return label + ': ' + value.toLocaleString('ru-RU');
              }
              return label + ': ' + value;
            }
          }
        }
      },
      scales: {
        x: {
          grid: { display: false },
          ticks: {
            color: '#94A3B8',
            font: { family: 'Inter', size: 12, weight: 'bold' }
          }
        },
        y: {
          type: 'linear',
          display: true,
          position: 'left',
          beginAtZero: true,
          grid: {
            color: 'rgba(148, 163, 184, 0.1)',
            drawBorder: false
          },
          ticks: {
            color: '#2481CC',
            font: { family: 'JetBrains Mono', size: 11 },
            callback: function(value) {
              return value.toLocaleString('ru-RU');
            }
          },
          title: {
            display: true,
            text: '–°–æ–æ–±—â–µ–Ω–∏—è',
            color: '#2481CC',
            font: { family: 'Inter', size: 12, weight: 'bold' }
          }
        },
        y1: {
          type: 'linear',
          display: true,
          position: 'right',
          beginAtZero: true,
          grid: { drawOnChartArea: false },
          ticks: {
            color: '#F97316',
            font: { family: 'JetBrains Mono', size: 11 }
          },
          title: {
            display: true,
            text: '–£—á–∞—Å—Ç–Ω–∏–∫–∏',
            color: '#F97316',
            font: { family: 'Inter', size: 12, weight: 'bold' }
          }
        }
      },
      animation: {
        duration: 1500,
        easing: 'easeInOutQuart',
        delay: function(context) {
          return context.dataIndex * 80;
        }
      }
    }
  };

  new Chart(ctx, config);
})();
</script>

{{ end }}
